---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: nexus
  namespace: registry
spec:
  interval: 5m
  chart:
    spec:
      # renovate: registryUrl=https://sonatype.github.io/helm3-charts/
      chart: nexus-repository-manager
      version: 30.1.0
      sourceRef:
        kind: HelmRepository
        name: sonatype-charts
        namespace: flux-system
  values:
    nexus:
      imagePullSecrets: []
      docker:
        enabled: true
        registries:
          - host: registry.${SECRET_DOMAIN}
            port: 5000
            secretName: registry.${SECRET_DOMAIN}
          - host: registry-cache.${SECRET_DOMAIN}
            port: 5001
            secretName: registry.${SECRET_DOMAIN}
    ingress:
      enabled: true
      annotations: {}
        # kubernetes.io/ingress.class: nginx
        # kubernetes.io/tls-acme: "true"
      hostPath: /
      hostRepo: nexus.${SECRET_DOMAIN}
      tls:
        - hosts:
            - nexus.${SECRET_DOMAIN}
    persistence:
      enabled: false
      accessMode: ReadWriteOnce
      ## If defined, storageClass: <storageClass>
      ## If set to "-", storageClass: "", which disables dynamic provisioning
      ## If undefined (the default) or set to null, no storageClass spec is
      ##   set, choosing the default provisioner.  (gp2 on AWS, standard on
      ##   GKE, AWS & OpenStack)
      ##
      # existingClaim:
      # annotations:
      #  "helm.sh/resource-policy": keep
      storageClass: flux-zfs
      storageSize: 100Gi
      # If PersistentDisk already exists you can create a PV for it by including the 2 following keypairs.
      # pdName: nexus-data-disk
      # fsType: ext4
    service:
      name: nexus3
      enabled: true
      labels: {}
      annotations: {}
      type: ClusterIP
      serviceType: ClusterIP
